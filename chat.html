<html>
  <head>
    <title>Linda sample chat</title>
  </head>
  <body>
    <h1>Linda sample chat</h1>
    <div id="rooms"></div>
    <input type="text" value="hello!" id="msg_body" />
    <input type="button" value="send" id="btn_send" />
    <input type="button" value="readp" id="btn_readp" />
    <input type="button" value="takep" id="btn_takep" />
    <div id="log"></div>
    <hr />
    <script src="/socket.io/socket.io.js"></script>
    <script src="/linda/linda.js"></script>
    <script src="/jquery/jquery.js"></script>
    <script>
      var server_url = "http://localhost:3000";

      var print = function(msg){
        $("#log").prepend( $("<p>").text(msg) );
      };

      var socket = io.connect(server_url);
      var linda = new Linda().connect(socket);
      var ts = linda.tuplespace("chatroom1");

      linda.io.on("connect", function(){
        print("connect!! " + server_url + "/chatroom1");

        // receive chat messages
        ts.watch({type: "chat"}, function(err, tuple){
          print("> " + tuple.data.message + "(from:" + tuple.from + ")");
        });
      });

      // on page load
      jQuery(function(){

        // send chat message
        $("#btn_send").click(function(){
          var msg = $("#msg_body").val();
          ts.write({type: "chat", message: msg});
        });

        $("#btn_readp").click(function(){
          var msg = $("#msg_body").val();
          ts.readp({type: "chat", message: msg}, function(err, tuple){
            if(tuple == null){
              print(err)
            } else {
              print("Tuple exists, msg: " + msg)
            }
          });
        });

        $("#btn_takep").click(function(){
          var msg = $("#msg_body").val();
          ts.takep({type: "chat", message: msg}, function(err, tuple){
            if(tuple == null){
              print(err)
            } else {
              print("Tuple exists, msg: " + msg)
            }
          });
        });

      });

    </script>
  </body>
</html>
